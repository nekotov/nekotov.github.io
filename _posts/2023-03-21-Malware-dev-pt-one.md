---
title: Malware dev - INTRO
layout: post
---

# Malware development pt. 1 - our story begins
## LEGAL NOTICE
This blog was written for SECURITY TESTING PURPOSES ONLY!

> THIS SOFTWARE IS PROVIDED FOR EDUCATIONAL USE ONLY! IF YOU ENGAGE IN ANY ILLEGAL ACTIVITY THE AUTHOR DOES NOT TAKE ANY RESPONSIBILITY FOR IT. BY USING THIS SOFTWARE YOU AGREE WITH THESE TERMS.

## Introduction
This is the first part of a series about malware development. In this series I want to implement some of the techniques used by malicious applications, hide from defenses and persist.

My goal of the series is to create some sort of malware for windows, which will be compiled on linux, using cross compilation. It can be as simple as a botnet or smth more complicated. As a source programming language will C++ be used.

Why C++? you might ask. Because it’s much more difficult to analyze as compiled binary when compared to managed code (C#, Visual Basic, and J#) or script (PowerShell, CMD, HTA, etc).

For the purpose of this and following articles I will use binaries from the MINGW project on Ubuntu 22.10.
## How does AV detection work?
AV solutions can use some of popular malware detecting solutions

* Signature based detection - examining the static characteristics of a file, such as its checksums (MD5, SHA1, etc.) and the detection of specific strings or byte sequences within the file using Yara rules
* Heuristic detection - refers to the practice of analyzing an application's behavior using a set of predetermined rules and identifying any potential indications of malicious intent. This technique primarily involves conducting a static analysis of the application's code and scanning for specific functions and other characteristics that are typically associated with malware.
* Sandboxing - performing dynamic analysis on a program by running it in a controlled environment (referred to as a sandbox) that allows for monitoring of its actions.

## Creating new project

### My environment 
```bash
sudo apt-get install g++-mingw-w64 vim make
```

### Simple C++ “Hello World!
Lets begin with simple program

```cpp
#include <iostream>

int main() {
    std::cout << "Hello, world!\n";
    return 0;
}
```
### Testing against VirusTotal

#### First attempt

```bash
i686-w64-mingw-g++-posix hello.cpp
```

[![First attempt](/images/maldev/pt1/vt1.png){:height="75%" width="75%"}](https://www.virustotal.com/gui/file/52cb2eac4b884a856415869b4b63ff75991dd3e06a0f7ca424dc2262105db879?nocache=1)
#### Second try

```bash 
i686-w64-mingw-g++-posix -static hello.cpp
```

[![Second try](/images/maldev/pt1/vt2.png){:height="75%" width="75%"}](https://www.virustotal.com/gui/file/262bf6c0cd07c8978fa3b9d38b8b92c5cbf67cbf3ccde8498306498ca1470db7?nocache=1)

#### Third attempt

```bash
i686-w64-mingw-g++-posix -static hello.cpp
strip a.exe 
```
[![Third attempt](/images/maldev/pt1/vt3.png){:height="75%" width="75%"}](https://www.virustotal.com/gui/file/fe914287612cf8e086049242e41c28048c42861900ef7868129133f070310c41?nocache=1)

#### And the last one

```bash
i686-w64-mingw-g++-posix -static hello.cpp
strip -x –only-keep-debug a.exe 
```
[![Last one](/images/maldev/pt1/vt4.png){:height="75%" width="75%"}](https://www.virustotal.com/gui/file/8fbebb873282e92c4aa5703c2e10387e913cf475c7236bef87e375248ce340ee?nocache=1)

## Summary
We created a C++ program that underwent some basic methods to decrease its detection rate, but it is still being detected by some antivirus programs.  The following article will concentrate on expanding the code and decreasing detection by AV.
